<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 1800" font-family="Segoe UI, Arial, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.2"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="1800" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-size="24" font-weight="bold" fill="#1a1a2e">CGT Experiment Pipeline v7</text>
  <text x="600" y="65" text-anchor="middle" font-size="14" fill="#666">Contrastive Geometric Transfer - 103 Cells</text>
  
  <!-- PHASE 1: SETUP -->
  <rect x="50" y="90" width="300" height="140" rx="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="2" filter="url(#shadow)"/>
  <text x="200" y="115" text-anchor="middle" font-size="12" font-weight="bold" fill="#1565c0">PHASE 1: SETUP (Cells 1-4)</text>
  <rect x="70" y="130" width="120" height="30" rx="4" fill="#fff" stroke="#1565c0"/>
  <text x="130" y="150" text-anchor="middle" font-size="10">1. Environment</text>
  <rect x="210" y="130" width="120" height="30" rx="4" fill="#fff" stroke="#1565c0"/>
  <text x="270" y="150" text-anchor="middle" font-size="10">2. Upload ZIP</text>
  <rect x="70" y="175" width="120" height="30" rx="4" fill="#fff" stroke="#1565c0"/>
  <text x="130" y="195" text-anchor="middle" font-size="10">3. Imports</text>
  <rect x="210" y="175" width="120" height="30" rx="4" fill="#fff" stroke="#1565c0"/>
  <text x="270" y="195" text-anchor="middle" font-size="10">4. Configuration</text>
  
  <!-- CGT-GW OPTIONAL (dashed border) -->
  <rect x="400" y="90" width="350" height="140" rx="8" fill="#fff3e0" stroke="#ff9800" stroke-width="2" stroke-dasharray="8,4" filter="url(#shadow)"/>
  <text x="575" y="115" text-anchor="middle" font-size="12" font-weight="bold" fill="#ff9800">‚öôÔ∏è CGT-GW INTERMEDIATE (Cell 5) ‚Äî OPTIONAL</text>
  <rect x="420" y="130" width="130" height="40" rx="4" fill="#fff" stroke="#ff9800"/>
  <text x="485" y="147" text-anchor="middle" font-size="9">üîÄ CGT-GW Switch</text>
  <text x="485" y="162" text-anchor="middle" font-size="8" fill="#666">USE_CGTGW_INTERMEDIATE</text>
  <rect x="570" y="130" width="80" height="30" rx="4" fill="#c8e6c9" stroke="#2e7d32"/>
  <text x="610" y="150" text-anchor="middle" font-size="9">OFF (default)</text>
  <rect x="660" y="130" width="80" height="30" rx="4" fill="#ffecb3" stroke="#f57c00"/>
  <text x="700" y="150" text-anchor="middle" font-size="9">ON</text>
  <rect x="480" y="180" width="200" height="35" rx="4" fill="#fff" stroke="#ff9800"/>
  <text x="580" y="195" text-anchor="middle" font-size="9">CGT-GW Preprocessing</text>
  <text x="580" y="208" text-anchor="middle" font-size="8" fill="#666">(OFFLINE, pre-training)</text>
  
  <!-- PHASE 2: TRAINING -->
  <rect x="800" y="90" width="350" height="140" rx="8" fill="#fff3e0" stroke="#ef6c00" stroke-width="2" filter="url(#shadow)"/>
  <text x="975" y="115" text-anchor="middle" font-size="12" font-weight="bold" fill="#ef6c00">PHASE 2: TRAINING (Cells 6-7)</text>
  <rect x="820" y="135" width="150" height="35" rx="4" fill="#fff" stroke="#ef6c00"/>
  <text x="895" y="157" text-anchor="middle" font-size="10">6. Train HYBRID</text>
  <rect x="980" y="135" width="150" height="35" rx="4" fill="#fff" stroke="#ef6c00"/>
  <text x="1055" y="157" text-anchor="middle" font-size="10">6b. PSI_SLM_FULL</text>
  <text x="975" y="200" text-anchor="middle" font-size="9" fill="#666">seed=42, mpnet-768d</text>
  
  <!-- PHASE 3: RETENTION -->
  <rect x="50" y="260" width="300" height="100" rx="8" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" filter="url(#shadow)"/>
  <text x="200" y="285" text-anchor="middle" font-size="12" font-weight="bold" fill="#2e7d32">PHASE 3: RETENTION (Cells 8-10)</text>
  <rect x="65" y="300" width="85" height="40" rx="4" fill="#fff" stroke="#2e7d32"/>
  <text x="107" y="318" text-anchor="middle" font-size="9">7b. Compute</text>
  <text x="107" y="330" text-anchor="middle" font-size="8">œÅ_s/œÅ_t</text>
  <rect x="158" y="300" width="85" height="40" rx="4" fill="#fff" stroke="#2e7d32"/>
  <text x="200" y="325" text-anchor="middle" font-size="9">7c. Checkpoints</text>
  <rect x="251" y="300" width="85" height="40" rx="4" fill="#fff" stroke="#2e7d32"/>
  <text x="293" y="325" text-anchor="middle" font-size="9">7d. Download</text>
  
  <!-- PHASE 4: EVALUATION -->
  <rect x="400" y="260" width="350" height="100" rx="8" fill="#fce4ec" stroke="#c2185b" stroke-width="2" filter="url(#shadow)"/>
  <text x="575" y="285" text-anchor="middle" font-size="12" font-weight="bold" fill="#c2185b">PHASE 4: EVALUATION (Cells 11-20)</text>
  <rect x="415" y="300" width="70" height="40" rx="4" fill="#fff" stroke="#c2185b"/>
  <text x="450" y="325" text-anchor="middle" font-size="9">7. Eval</text>
  <rect x="495" y="300" width="70" height="40" rx="4" fill="#fff" stroke="#c2185b"/>
  <text x="530" y="318" text-anchor="middle" font-size="9">7a. F1-F3</text>
  <text x="530" y="332" text-anchor="middle" font-size="8" fill="#666">Falsify</text>
  <rect x="575" y="300" width="50" height="40" rx="4" fill="#fff" stroke="#c2185b"/>
  <text x="600" y="325" text-anchor="middle" font-size="8">F1</text>
  <rect x="630" y="300" width="50" height="40" rx="4" fill="#fff" stroke="#c2185b"/>
  <text x="655" y="325" text-anchor="middle" font-size="8">F2</text>
  <rect x="685" y="300" width="50" height="40" rx="4" fill="#fff" stroke="#c2185b"/>
  <text x="710" y="325" text-anchor="middle" font-size="8">F3</text>
  
  <!-- PHASE 5: CARTESIAN -->
  <rect x="800" y="260" width="350" height="100" rx="8" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" filter="url(#shadow)"/>
  <text x="975" y="285" text-anchor="middle" font-size="12" font-weight="bold" fill="#7b1fa2">PHASE 5: CARTESIAN (Cells 21-27)</text>
  <rect x="820" y="300" width="100" height="40" rx="4" fill="#fff" stroke="#7b1fa2"/>
  <text x="870" y="325" text-anchor="middle" font-size="9">Dataset Gen</text>
  <rect x="930" y="300" width="100" height="40" rx="4" fill="#fff" stroke="#7b1fa2"/>
  <text x="980" y="318" text-anchor="middle" font-size="9">Cartesian</text>
  <text x="980" y="332" text-anchor="middle" font-size="8" fill="#666">S√óT√óD</text>
  <rect x="1040" y="300" width="90" height="40" rx="4" fill="#fff" stroke="#7b1fa2"/>
  <text x="1085" y="325" text-anchor="middle" font-size="9">Results</text>
  
  <!-- PHASE 6: ABLATIONS -->
  <rect x="50" y="390" width="500" height="100" rx="8" fill="#e0f7fa" stroke="#00838f" stroke-width="2" filter="url(#shadow)"/>
  <text x="300" y="415" text-anchor="middle" font-size="12" font-weight="bold" fill="#00838f">PHASE 6: ABLATIONS (Cells 28-33)</text>
  <rect x="65" y="435" width="70" height="35" rx="4" fill="#fff" stroke="#00838f"/>
  <text x="100" y="457" text-anchor="middle" font-size="9">9. Cascade</text>
  <rect x="145" y="435" width="70" height="35" rx="4" fill="#fff" stroke="#00838f"/>
  <text x="180" y="457" text-anchor="middle" font-size="9">10. Euclid</text>
  <rect x="225" y="435" width="70" height="35" rx="4" fill="#fff" stroke="#00838f"/>
  <text x="260" y="457" text-anchor="middle" font-size="9">11. Dim</text>
  <rect x="305" y="435" width="70" height="35" rx="4" fill="#fff" stroke="#00838f"/>
  <text x="340" y="457" text-anchor="middle" font-size="9">12. Capacity</text>
  <rect x="385" y="435" width="70" height="35" rx="4" fill="#fff" stroke="#00838f"/>
  <text x="420" y="457" text-anchor="middle" font-size="9">13. MRL</text>
  <rect x="465" y="435" width="70" height="35" rx="4" fill="#fff" stroke="#00838f"/>
  <text x="500" y="457" text-anchor="middle" font-size="9">14. BQ</text>
  
  <!-- PHASE 7: BENCHMARKS -->
  <rect x="600" y="390" width="280" height="100" rx="8" fill="#fff8e1" stroke="#f9a825" stroke-width="2" filter="url(#shadow)"/>
  <text x="740" y="415" text-anchor="middle" font-size="12" font-weight="bold" fill="#f9a825">PHASE 7: BENCHMARKS (34-38)</text>
  <rect x="615" y="435" width="60" height="35" rx="4" fill="#fff" stroke="#f9a825"/>
  <text x="645" y="457" text-anchor="middle" font-size="9">15. Lat</text>
  <rect x="685" y="435" width="60" height="35" rx="4" fill="#fff" stroke="#f9a825"/>
  <text x="715" y="457" text-anchor="middle" font-size="9">16. Rob</text>
  <rect x="755" y="435" width="60" height="35" rx="4" fill="#fff" stroke="#f9a825"/>
  <text x="785" y="457" text-anchor="middle" font-size="9">17. Stor</text>
  <rect x="825" y="435" width="50" height="35" rx="4" fill="#fff" stroke="#f9a825"/>
  <text x="850" y="457" text-anchor="middle" font-size="8">18-19</text>
  
  <!-- PHASE 8: MULTI-SEED -->
  <rect x="920" y="390" width="230" height="100" rx="8" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" filter="url(#shadow)"/>
  <text x="1035" y="415" text-anchor="middle" font-size="12" font-weight="bold" fill="#3f51b5">PHASE 8: MULTI-SEED (39-53)</text>
  <rect x="935" y="435" width="50" height="35" rx="4" fill="#fff" stroke="#3f51b5"/>
  <text x="960" y="450" text-anchor="middle" font-size="8">20.</text>
  <text x="960" y="462" text-anchor="middle" font-size="7">Config</text>
  <rect x="995" y="435" width="50" height="35" rx="4" fill="#fff" stroke="#3f51b5"/>
  <text x="1020" y="450" text-anchor="middle" font-size="8">21-26</text>
  <text x="1020" y="462" text-anchor="middle" font-size="7">√ó3 seeds</text>
  <rect x="1055" y="435" width="50" height="35" rx="4" fill="#fff" stroke="#3f51b5"/>
  <text x="1080" y="450" text-anchor="middle" font-size="8">27-34</text>
  <text x="1080" y="462" text-anchor="middle" font-size="7">Stats</text>
  
  <!-- PHASE 9: TEACHER SWEEP -->
  <rect x="50" y="520" width="280" height="90" rx="8" fill="#fbe9e7" stroke="#ff5722" stroke-width="2" filter="url(#shadow)"/>
  <text x="190" y="545" text-anchor="middle" font-size="12" font-weight="bold" fill="#ff5722">PHASE 9: TEACHER SWEEP (54-58)</text>
  <rect x="65" y="565" width="80" height="30" rx="4" fill="#fff" stroke="#ff5722"/>
  <text x="105" y="585" text-anchor="middle" font-size="9">35. Config</text>
  <rect x="155" y="565" width="80" height="30" rx="4" fill="#fff" stroke="#ff5722"/>
  <text x="195" y="585" text-anchor="middle" font-size="9">36. Eval</text>
  <rect x="245" y="565" width="80" height="30" rx="4" fill="#fff" stroke="#ff5722"/>
  <text x="285" y="585" text-anchor="middle" font-size="9">37-39. Rank</text>
  
  <!-- PHASE 10: EXTENDED EVAL -->
  <rect x="380" y="520" width="420" height="90" rx="8" fill="#f1f8e9" stroke="#689f38" stroke-width="2" filter="url(#shadow)"/>
  <text x="590" y="545" text-anchor="middle" font-size="12" font-weight="bold" fill="#689f38">PHASE 10: EXTENDED EVAL (Cells 59-92)</text>
  <rect x="395" y="565" width="90" height="30" rx="4" fill="#fff" stroke="#689f38"/>
  <text x="440" y="585" text-anchor="middle" font-size="9">40-49 Final</text>
  <rect x="495" y="565" width="90" height="30" rx="4" fill="#fff" stroke="#689f38"/>
  <text x="540" y="585" text-anchor="middle" font-size="9">50-59 Cascade</text>
  <rect x="595" y="565" width="90" height="30" rx="4" fill="#fff" stroke="#689f38"/>
  <text x="640" y="585" text-anchor="middle" font-size="9">60-72 Ablat</text>
  <rect x="695" y="565" width="90" height="30" rx="4" fill="#fff" stroke="#689f38"/>
  <text x="740" y="585" text-anchor="middle" font-size="9">73. Summary</text>
  
  <!-- PHASE 11: FINAL DELIVERY -->
  <rect x="850" y="520" width="300" height="90" rx="8" fill="#efebe9" stroke="#5d4037" stroke-width="2" filter="url(#shadow)"/>
  <text x="1000" y="545" text-anchor="middle" font-size="12" font-weight="bold" fill="#5d4037">PHASE 11: FINAL DELIVERY (93-101)</text>
  <rect x="865" y="565" width="85" height="30" rx="4" fill="#fff" stroke="#5d4037"/>
  <text x="907" y="585" text-anchor="middle" font-size="9">Suite</text>
  <rect x="960" y="565" width="85" height="30" rx="4" fill="#fff" stroke="#5d4037"/>
  <text x="1002" y="585" text-anchor="middle" font-size="9">MANIFEST</text>
  <rect x="1055" y="565" width="85" height="30" rx="4" fill="#fff" stroke="#5d4037"/>
  <text x="1097" y="585" text-anchor="middle" font-size="9">ZIP</text>
  
  <!-- Flow arrows -->
  <path d="M350 160 L395 160" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M750 160 L795 160" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M200 230 L200 255" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M350 310 L395 310" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M750 310 L795 310" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M975 360 L975 385" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M550 390 L550 420" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M300 490 L300 515" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M330 565 L375 565" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  <path d="M800 565 L845 565" stroke="#666" stroke-width="2" marker-end="url(#arrow)" fill="none"/>
  
  <!-- Legend -->
  <rect x="50" y="640" width="1100" height="80" rx="8" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
  <text x="600" y="665" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">Legend</text>
  
  <rect x="70" y="685" width="20" height="15" rx="2" fill="#e3f2fd" stroke="#1565c0"/>
  <text x="100" y="697" font-size="10" fill="#333">Setup</text>
  
  <rect x="160" y="685" width="20" height="15" rx="2" fill="#fff3e0" stroke="#ff9800" stroke-dasharray="4,2"/>
  <text x="190" y="697" font-size="10" fill="#333">CGT-GW (Optional)</text>
  
  <rect x="300" y="685" width="20" height="15" rx="2" fill="#fff3e0" stroke="#ef6c00"/>
  <text x="330" y="697" font-size="10" fill="#333">Training</text>
  
  <rect x="400" y="685" width="20" height="15" rx="2" fill="#e8f5e9" stroke="#2e7d32"/>
  <text x="430" y="697" font-size="10" fill="#333">Retention</text>
  
  <rect x="510" y="685" width="20" height="15" rx="2" fill="#fce4ec" stroke="#c2185b"/>
  <text x="540" y="697" font-size="10" fill="#333">Evaluation</text>
  
  <rect x="620" y="685" width="20" height="15" rx="2" fill="#f3e5f5" stroke="#7b1fa2"/>
  <text x="650" y="697" font-size="10" fill="#333">Cartesian</text>
  
  <rect x="730" y="685" width="20" height="15" rx="2" fill="#e0f7fa" stroke="#00838f"/>
  <text x="760" y="697" font-size="10" fill="#333">Ablations</text>
  
  <rect x="840" y="685" width="20" height="15" rx="2" fill="#fff8e1" stroke="#f9a825"/>
  <text x="870" y="697" font-size="10" fill="#333">Benchmarks</text>
  
  <rect x="960" y="685" width="20" height="15" rx="2" fill="#efebe9" stroke="#5d4037"/>
  <text x="990" y="697" font-size="10" fill="#333">Final</text>
  
  <!-- CGT-GW Note -->
  <rect x="50" y="740" width="1100" height="50" rx="6" fill="#fffde7" stroke="#ffc107" stroke-width="2"/>
  <text x="80" y="762" font-size="11" font-weight="bold" fill="#f57c00">‚ö†Ô∏è CGT-GW Structural Intermediate:</text>
  <text x="330" y="762" font-size="11" fill="#333">OFFLINE preprocessing ‚Ä¢ NOT in training loop ‚Ä¢ Control:</text>
  <text x="675" y="762" font-size="11" font-family="monospace" fill="#d84315">USE_CGTGW_INTERMEDIATE = True/False</text>
  <text x="980" y="762" font-size="11" fill="#333">(default: False)</text>
  <text x="80" y="780" font-size="10" fill="#666">OFF: Teacher ‚Üí Student | ON: Teacher ‚Üí CGT-GW ‚Üí Student (generates structured targets before distillation)</text>
</svg>
