# ============================================================================
# Kustomization - Base Configuration
# ============================================================================
# Gerencia múltiplos ambientes sem duplicar YAML
#
# Estrutura:
#   k8s/
#   ├── base/          # Configuração comum
#   ├── overlays/
#   │   ├── dev/       # Customizações dev
#   │   ├── staging/   # Customizações staging
#   │   └── prod/      # Customizações prod
#   └── kustomization.yaml
#
# Deploy:
#   kubectl apply -k k8s/overlays/prod/
# ============================================================================

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# --------------------------------------------------------------------------
# Namespace padrão
# --------------------------------------------------------------------------
namespace: default

# --------------------------------------------------------------------------
# Resources - Arquivos YAML a aplicar
# --------------------------------------------------------------------------
resources:
- deployment.yaml
- service.yaml
- ingress.yaml
- configmap.yaml
- secret.yaml
- pvc.yaml
- namespace.yaml

# --------------------------------------------------------------------------
# Labels comuns
# --------------------------------------------------------------------------
commonLabels:
  app: wine-quality-api
  managed-by: kustomize

# --------------------------------------------------------------------------
# Annotations comuns
# --------------------------------------------------------------------------
commonAnnotations:
  description: "Wine Quality Prediction ML API"
  maintainer: "gokuhayda@github.com"

# --------------------------------------------------------------------------
# Images - Sobrescrever image tags
# --------------------------------------------------------------------------
images:
- name: cd4ml-wine-quality
  newTag: v1.0.0  # Ou commit SHA para prod

# --------------------------------------------------------------------------
# Replicas - Ajustar número de réplicas
# --------------------------------------------------------------------------
replicas:
- name: wine-quality-api
  count: 3

# ============================================================================
# OVERLAYS - Customizações por ambiente
# ============================================================================
#
# k8s/overlays/prod/kustomization.yaml:
#
# apiVersion: kustomize.config.k8s.io/v1beta1
# kind: Kustomization
#
# bases:
# - ../../base
#
# namespace: production
#
# images:
# - name: cd4ml-wine-quality
#   newTag: v1.2.3  # Versão específica em prod
#
# replicas:
# - name: wine-quality-api
#   count: 10  # Mais réplicas em prod
#
# patchesStrategicMerge:
# - increase-resources.yaml  # Mais CPU/mem em prod
#
# ============================================================================